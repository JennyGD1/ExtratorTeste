<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Extrator de Contracheques - Maida Health</title>
    <!-- CSS Global -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
  <!-- CSS Espec칤fico -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/preloader.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='img/logo_maida.png') }}">
</head>
<body class="page-index">
  {% include '_preloader.html' %}
  
  <div class="logo">
    <img src="{{ url_for('static', filename='img/logo_maida.png') }}" alt="Logo da Maida Health" loading="lazy">
  </div>

  <main>
    <div class="borda-animada">
      <div class="content-box">
        <h1><strong>Calculadora de Mensalidades</strong></h1>
        <input type="file" id="file-upload" multiple hidden aria-label="Selecionar arquivos">
        <label for="file-upload" class="upload-btn">游늬 Escolher Arquivos</label>
        <p id="file-name" class="file-name" aria-live="polite">Nenhum arquivo selecionado</p>
        <button type="button" class="process-btn" aria-busy="false">Processar</button>
        <progress id="upload-progress" value="0" max="100" hidden></progress>
      </div>
    </div>

    <!-- Se칞칚o RH BAHIA -->
    <div class="borda-animada" style="margin-top: 30px;">
      <div class="content-box">
        <h2><strong>Buscar Contracheque do RH BAHIA</strong></h2>
        
        <form id="formLoginRhBahia" class="form-rh">
          <input type="text" class="input-field" name="username" placeholder="Usu치rio" required>
          <input type="password" class="input-field" name="password" placeholder="Senha" required>
          <button type="submit" class="upload-btn">Logar</button>
        </form>

        <form id="formBuscarContracheque" class="form-rh" style="display: none;">
          <input type="text" class="input-field" name="matricula" placeholder="Matr칤cula" pattern="\d+" required>
          <button type="submit" class="upload-btn">Buscar Contracheque</button>
          <button type="button" id="logoutRhBahia" class="process-btn" style="margin-top: 10px;">Sair</button>
        </form>

        <div id="rh-bahia-error" class="error-message" style="display: none;"></div>
        <div id="resultadoRhBahia" class="resultado-container"></div>
      </div>
    </div>
  </main>

  <footer>
    Desenvolvido por Jennifer Lima
  </footer>

  <div class="bg-shapes">
    <svg viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg">
      <g transform="translate(300,300)">
        <path d="M150,-164C198,-122,235,-61,230,-4.6C225,51,178,102,130,146C82,190,34,228,-20,236C-73,244,-145,221,-176,172C-207,123,-197,48,-180,-20C-163,-89,-138,-151,-94,-190C-50,-229,13,-244,75,-231C137,-218,199,-176,150,-164Z" fill="rgba(255, 255, 255, 0.05)"/>
      </g>
    </svg>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Seu c칩digo existente para upload de arquivos permanece igual
      const fileInput = document.getElementById('file-upload');
      const fileNameText = document.getElementById('file-name');
      const processBtn = document.querySelector('.process-btn');
      const progressBar = document.getElementById('upload-progress');

      // ... (c칩digo existente de upload)

      // ===== RH BAHIA =====
      const loginForm = document.getElementById('formLoginRhBahia');
      const buscaForm = document.getElementById('formBuscarContracheque');
      const logoutBtn = document.getElementById('logoutRhBahia');
      const errorElement = document.getElementById('rh-bahia-error');
      const resultadoElement = document.getElementById('resultadoRhBahia');

      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(loginForm);
        
        try {
          const response = await fetch('/login_rh_bahia', {
            method: 'POST',
            body: formData
          });
          
          const data = await response.json();
          
          if (data.success) {
            errorElement.style.display = 'none';
            buscaForm.style.display = 'block';
            resultadoElement.innerHTML = '';
          } else {
            errorElement.style.display = 'block';
            errorElement.textContent = data.error || 'Erro no login';
          }
        } catch (error) {
          errorElement.style.display = 'block';
          errorElement.textContent = 'Erro de conex칚o com o servidor';
        }
      });

      buscaForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(buscaForm);
        
        try {
          const response = await fetch('/buscar_contracheque_rh_bahia', {
            method: 'POST',
            body: formData
          });
          
          const data = await response.json();
          
          if (data.success) {
            errorElement.style.display = 'none';
            resultadoElement.innerHTML = `
              <div class="resultado-item">
                <h3>${data.dados.mes_ano}</h3>
                <p><strong>Sal치rio:</strong> R$ ${data.dados.salario}</p>
                <p><strong>Descontos:</strong> R$ ${data.dados.descontos}</p>
              </div>
            `;
          } else {
            errorElement.style.display = 'block';
            errorElement.textContent = data.error || 'Erro ao buscar contracheque';
          }
        } catch (error) {
          errorElement.style.display = 'block';
          errorElement.textContent = 'Erro de conex칚o com o servidor';
        }
      });

      logoutBtn.addEventListener('click', async () => {
        try {
          await fetch('/logout_rh_bahia', { method: 'POST' });
          buscaForm.style.display = 'none';
          resultadoElement.innerHTML = '';
          loginForm.reset();
        } catch (error) {
          errorElement.style.display = 'block';
          errorElement.textContent = 'Erro ao sair';
        }
      });
    });
  </script>

  <script>
    // Esconde o preloader quando a p치gina estiver totalmente carregada
    window.addEventListener('load', function() {
        const preloader = document.getElementById('preloader');
        if (preloader) {
            // Adiciona transi칞칚o suave antes de remover
            preloader.style.opacity = '0';
            setTimeout(() => {
                preloader.style.display = 'none';
            }, 500); // Tempo igual  dura칞칚o da transi칞칚o (0.5s)
        }
    });

    // Caso a p치gina demore muito para carregar, for칞a ap칩s 5 segundos
    setTimeout(() => {
        const preloader = document.getElementById('preloader');
        if (preloader && preloader.style.display !== 'none') {
            preloader.style.opacity = '0';
            setTimeout(() => {
                preloader.style.display = 'none';
            }, 500);
        }
    }, 5000);
</script>
</body>
</html>
