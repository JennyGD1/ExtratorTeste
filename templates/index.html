<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Extrator de Contracheques - Maida Health</title>
  <!-- CSS Global -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
  <!-- CSS Espec√≠fico -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/preloader.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='img/logo_maida.png') }}">
</head>
<body class="page-index">
  {% include '_preloader.html' %}
  
  <div class="logo">
    <img src="{{ url_for('static', filename='img/logo_maida.png') }}" alt="Logo da Maida Health" loading="lazy">
  </div>

  <main>
    <!-- Se√ß√£o da Calculadora -->
    <div class="borda-animada">
      <div class="content-box">
        <h1><strong>Calculadora de Mensalidades</strong></h1>
        
        <div class="info-box">
          <p>‚ö†Ô∏è Para usar esta ferramenta:</p>
          <ol>
            <li>Fa√ßa login no <a href="https://rhbahia.ba.gov.br/login" target="_blank">RH BAHIA</a></li>
            <li>Volte para esta p√°gina</li>
            <li>Selecione os arquivos ou informe a matr√≠cula</li>
          </ol>
        </div>

        <!-- Op√ß√£o 1: Upload de PDF -->
        <div class="upload-section">
          <input type="file" id="file-upload" multiple hidden aria-label="Selecionar arquivos">
          <label for="file-upload" class="upload-btn">üìÅ Escolher Arquivos PDF</label>
          <p id="file-name" class="file-name" aria-live="polite">Nenhum arquivo selecionado</p>
          <button type="button" id="process-pdf" class="process-btn" aria-busy="false">Processar PDFs</button>
          <progress id="upload-progress" value="0" max="100" hidden></progress>
        </div>

        <!-- Op√ß√£o 2: Busca por matr√≠cula (ap√≥s login externo) -->
        <div class="matricula-section" style="margin-top: 30px;">
          <h3>Ou busque diretamente por matr√≠cula</h3>
          <form id="formContracheque">
            <input type="text" class="input-field" name="matricula" placeholder="Digite sua matr√≠cula" required>
            <button type="submit" class="process-btn">Buscar Contracheque</button>
          </form>
        </div>
      </div>
    </div>
  </main>

  <footer>
    Desenvolvido por Jennifer Lima
  </footer>

  <div class="bg-shapes">
    <svg viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg">
      <g transform="translate(300,300)">
        <path d="M150,-164C198,-122,235,-61,230,-4.6C225,51,178,102,130,146C82,190,34,228,-20,236C-73,244,-145,221,-176,172C-207,123,-197,48,-180,-20C-163,-89,-138,-151,-94,-190C-50,-229,13,-244,75,-231C137,-218,199,-176,150,-164Z" fill="rgba(255, 255, 255, 0.05)"/>
      </g>
    </svg>
  </div>

  <script>
    // Preloader
    window.addEventListener('load', function() {
      const preloader = document.getElementById('preloader');
      if (preloader) {
        preloader.style.opacity = '0';
        setTimeout(() => preloader.style.display = 'none', 500);
      }
    });

    setTimeout(() => {
      const preloader = document.getElementById('preloader');
      if (preloader && preloader.style.display !== 'none') {
        preloader.style.opacity = '0';
        setTimeout(() => preloader.style.display = 'none', 500);
      }
    }, 5000);

    // Upload de PDFs
    document.getElementById('file-upload').addEventListener('change', function() {
      const fileNameText = document.getElementById('file-name');
      if (this.files.length === 0) {
        fileNameText.textContent = 'Nenhum arquivo selecionado';
      } else {
        fileNameText.textContent = this.files.length === 1 
          ? this.files[0].name 
          : `${this.files.length} arquivos selecionados`;
      }
    });

    document.getElementById('process-pdf').addEventListener('click', async function() {
      const files = document.getElementById('file-upload').files;
      if (!files || files.length === 0) {
        alert('Selecione pelo menos um arquivo PDF');
        return;
      }
      
      // Seu c√≥digo de processamento de PDFs
    });

    // Busca por matr√≠cula
    document.getElementById('formContracheque').addEventListener('submit', async (e) => {
      e.preventDefault();
      const matricula = e.target.matricula.value;
      
      try {
        const response = await fetch('/buscar_contracheque', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: `matricula=${matricula}`
        });
        
        if (response.status === 401) {
          window.open('https://rhbahia.ba.gov.br/login', '_blank');
          alert('Fa√ßa login no RH BAHIA primeiro!');
          return;
        }
        
        const result = await response.json();
        // Processar os resultados aqui
        
      } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao buscar contracheque');
      }
    });
  </script>
</body>
</html>
